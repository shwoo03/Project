{% extends "base.html" %}

{% block title %}WSunghun / Docker - Networks{% endblock %}

{% block head %}
<style>
    .network-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
    }

    .network-card:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
    }

    .network-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .network-name {
        font-size: 1.2rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .network-name i {
        color: var(--accent);
    }

    .network-badge {
        font-size: 0.75rem;
        padding: 4px 10px;
        border-radius: 20px;
        font-family: 'JetBrains Mono', monospace;
        text-transform: uppercase;
    }

    .badge-bridge {
        background: rgba(59, 130, 246, 0.2);
        color: #60a5fa;
        border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .badge-host {
        background: rgba(245, 158, 11, 0.2);
        color: #fbbf24;
        border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .badge-overlay {
        background: rgba(139, 92, 246, 0.2);
        color: #a78bfa;
        border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .badge-null {
        background: rgba(107, 114, 128, 0.2);
        color: #9ca3af;
        border: 1px solid rgba(107, 114, 128, 0.3);
    }

    .network-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
    }

    .meta-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .meta-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-family: 'JetBrains Mono', monospace;
    }

    .meta-value {
        font-size: 0.9rem;
        font-family: 'JetBrains Mono', monospace;
    }

    .containers-section {
        border-top: 1px solid var(--border);
        padding-top: 15px;
    }

    .containers-title {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .containers-title .count {
        background: var(--accent);
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
    }

    .connected-containers {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .container-chip {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 8px;
        font-size: 0.85rem;
    }

    .container-chip .chip-name {
        font-weight: 500;
    }

    .container-chip .chip-ip {
        color: var(--text-muted);
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.8rem;
    }

    .no-containers {
        color: var(--text-muted);
        font-size: 0.85rem;
        font-style: italic;
    }

    .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 60px;
    }

    .loading-spinner i {
        font-size: 2rem;
        color: var(--accent);
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        from {
            transform: rotate(0deg);
        }

        to {
            transform: rotate(360deg);
        }
    }
</style>
{% endblock %}

{% block content %}
<h1 class="dashboard-title">Networks.</h1>
<p class="dashboard-desc">Docker network configuration and connected containers.</p>

<div class="stats-row">
    <div class="stat-item">
        <span class="stat-label">Total Networks</span>
        <span class="stat-value" id="total-count">0</span>
    </div>
    <div class="stat-item">
        <span class="stat-label">Bridge</span>
        <span class="stat-value" id="bridge-count" style="color: #60a5fa">0</span>
    </div>
    <div class="stat-item">
        <span class="stat-label">Host</span>
        <span class="stat-value" id="host-count" style="color: #fbbf24">0</span>
    </div>
</div>

<div class="section-header">
    <h2>Network List</h2>
    <button class="btn-mini" onclick="loadNetworks()">
        <i class="fas fa-sync-alt"></i> Refresh
    </button>
</div>

<div class="network-list" id="network-list">
    <div class="loading-spinner">
        <i class="fas fa-circle-notch"></i>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const networkList = document.getElementById('network-list');
    const totalEl = document.getElementById('total-count');
    const bridgeEl = document.getElementById('bridge-count');
    const hostEl = document.getElementById('host-count');

    async function loadNetworks() {
        networkList.innerHTML = `
                <div class="loading-spinner">
                    <i class="fas fa-circle-notch"></i>
                </div>
            `;

        try {
            const response = await fetch('/api/networks');
            const result = await response.json();
            const networks = result.data;

            // Update counts
            totalEl.textContent = networks.length;
            bridgeEl.textContent = networks.filter(n => n.driver === 'bridge').length;
            hostEl.textContent = networks.filter(n => n.driver === 'host').length;

            renderNetworks(networks);
        } catch (error) {
            console.error('Error loading networks:', error);
            networkList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Failed to load networks</h3>
                        <p>${error.message}</p>
                    </div>
                `;
        }
    }

    function renderNetworks(networks) {
        if (networks.length === 0) {
            networkList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-network-wired"></i>
                        <h3>No Networks Found</h3>
                        <p>Docker networks will appear here.</p>
                    </div>
                `;
            return;
        }

        networkList.innerHTML = networks.map(network => `
                <div class="network-card">
                    <div class="network-header">
                        <div class="network-name">
                            <i class="fas fa-network-wired"></i>
                            ${network.name}
                        </div>
                        <span class="network-badge badge-${network.driver}">${network.driver}</span>
                    </div>
                    
                    <div class="network-meta">
                        <div class="meta-item">
                            <span class="meta-label">ID</span>
                            <span class="meta-value">${network.id}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Scope</span>
                            <span class="meta-value">${network.scope}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Subnet</span>
                            <span class="meta-value">${network.subnet || 'N/A'}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Gateway</span>
                            <span class="meta-value">${network.gateway || 'N/A'}</span>
                        </div>
                    </div>

                    <div class="containers-section">
                        <div class="containers-title">
                            <i class="fas fa-cube"></i>
                            Connected Containers
                            <span class="count">${network.container_count}</span>
                        </div>
                        ${network.containers.length > 0 ? `
                            <div class="connected-containers">
                                ${network.containers.map(c => `
                                    <div class="container-chip">
                                        <span class="chip-name">${c.name}</span>
                                        <span class="chip-ip">${c.ipv4 || 'No IP'}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <span class="no-containers">No containers connected</span>
                        `}
                    </div>
                </div>
            `).join('');
    }

    // Removed showToast as it's now in app.js (check before removing? app.js has it, base.html includes app.js)

    // Init
    document.addEventListener('DOMContentLoaded', loadNetworks);
</script>
{% endblock %}